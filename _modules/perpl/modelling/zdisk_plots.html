<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>perpl.modelling.zdisk_plots &#8212; PERPL  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for perpl.modelling.zdisk_plots</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">zdisk_plots.py</span>

<span class="sd">Functions for plotting figures for manuscript on PERPL</span>
<span class="sd">technique.</span>

<span class="sd">Alistair Curd</span>
<span class="sd">University of Leeds</span>
<span class="sd">30 March 2020</span>

<span class="sd">---</span>
<span class="sd">Copyright 2020 Peckham Lab</span>

<span class="sd">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use</span>
<span class="sd">this file except in compliance with the License. You may obtain a copy of the</span>
<span class="sd">License at</span>
<span class="sd">http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="sd">Unless required by applicable law or agreed to in writing, software distributed</span>
<span class="sd">under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR</span>
<span class="sd">CONDITIONS OF ANY KIND, either express or implied. See the License for the</span>
<span class="sd">specific language governing permissions and limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">perpl.modelling.linearrepeatmodels</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">linmods</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">zdisk_modelling</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.modelling_general</span><span class="w"> </span><span class="kn">import</span> <span class="n">kde_1nm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.modelling_general</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_correlation_1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.modelling_general</span><span class="w"> </span><span class="kn">import</span> <span class="n">stdev_of_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.io.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">estimate_rpd_churchman_1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">read_relpos_from_pickles</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">getaxialseparations_no_smoothing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">remove_duplicates</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_up_model_4_variable_peaks_with_fit_settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_up_model_5_variable_peaks_with_fit_settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.zdisk_modelling</span><span class="w"> </span><span class="kn">import</span> <span class="n">fitmodel_to_hist</span>


<div class="viewcode-block" id="plot_distance_hist">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_distance_hist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_distance_hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot histogram of experimental distances, with 1 nm bins.</span>

<span class="sd">    Args:</span>
<span class="sd">        distances (numpy array-like):</span>
<span class="sd">            Set of distances (nm) to plot.</span>
<span class="sd">        fitlength (float):</span>
<span class="sd">            The distance upto which the histogram will be calculated.</span>
<span class="sd">        color (string):</span>
<span class="sd">            Colour for the matplotlib histogram.</span>
<span class="sd">    Returns:</span>
<span class="sd">        hist_values (numpy array):</span>
<span class="sd">            Histogram bin values.</span>
<span class="sd">        bin_edges (numpy array):</span>
<span class="sd">            Histogram bin edge positions. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Histogram figure with 1-nm bins</span>
    <span class="n">histfig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">histaxes</span> <span class="o">=</span> <span class="n">histfig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">hist_values</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">histaxes</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span>
                                           <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                                           <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span>
                                           <span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># 2 not required</span>
    <span class="n">histaxes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">])</span>
    <span class="c1"># histaxes.set_ylim([0, 82])</span>
    <span class="n">histaxes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">histaxes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram&#39;</span><span class="p">)</span>
    <span class="n">histaxes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$X (nm) ($\Delta$YZ &lt; 10 nm)&#39;</span><span class="p">)</span>
    <span class="n">histaxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hist_values</span><span class="p">,</span> <span class="n">bin_edges</span></div>



<div class="viewcode-block" id="plot_distance_kde">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_distance_kde">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_distance_kde</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">locprec</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot KDE (using localisation precision) of experimental distances.</span>

<span class="sd">    Args:</span>
<span class="sd">        distances (numpy array-like):</span>
<span class="sd">            Set of distances (nm) to plot.</span>
<span class="sd">        locprec:</span>
<span class="sd">            Average localisation precision of the localisations involved.</span>
<span class="sd">        fitlength (float):</span>
<span class="sd">            The distance upto which the KDE will be evaluated.</span>
<span class="sd">        color (string):</span>
<span class="sd">            Colour for the shaded KDE.</span>
<span class="sd">    Returns:</span>
<span class="sd">        kde_x_values (numpy array):</span>
<span class="sd">            Distances at which the kde is evaluated.</span>
<span class="sd">        kde (numpy array):</span>
<span class="sd">            The density estimated at kde_x_points.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set kde kernel size</span>
    <span class="n">kernel_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">locprec</span>

    <span class="n">kdefig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">kdeaxes</span> <span class="o">=</span> <span class="n">kdefig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">kde_x_values</span><span class="p">,</span> <span class="n">kde</span> <span class="o">=</span> <span class="n">kde_1nm</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">locprec</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">)</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">kde_x_values</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kde</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Start x-axis from 3 * kernel size, to avoid kde problems around zero.</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">3</span> <span class="o">*</span> <span class="n">kernel_size</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">])</span>
    <span class="c1"># kdeaxes.set_ylim([0, 82])</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$X (nm) ($\Delta$YZ &lt; 10 nm)&#39;</span><span class="p">)</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;KDE</span><span class="se">\n</span><span class="s1">(Gaussian kernel, &#39;</span>
                      <span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\sigma$ = </span><span class="si">{:.1f}</span><span class="s1"> nm)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kernel_size</span><span class="p">))</span>
    <span class="n">kdeaxes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kde_x_values</span><span class="p">,</span> <span class="n">kde</span></div>



<div class="viewcode-block" id="plot_distance_hist_and_fit">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_distance_hist_and_fit">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_distance_hist_and_fit</span><span class="p">(</span>
                <span class="n">axpoints</span><span class="p">,</span>
                <span class="n">fitlength</span><span class="p">,</span>
                <span class="n">params_optimised</span><span class="p">,</span>
                <span class="n">params_covar</span><span class="p">,</span>
                <span class="n">model_with_info</span><span class="p">,</span>
                <span class="n">plot_95ci</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bin_centres</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
              <span class="n">bins</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># x, kde = kde_1nm(axpoints)</span>
    <span class="c1"># ax.plot(x, kde)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span>
              <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span> <span class="o">*</span><span class="n">params_optimised</span><span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
              <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span>
              <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">])</span>
    <span class="c1"># axes.set_xlabel(r&#39;$\Delta$X (nm) ($\Delta$YZ &lt; 10 nm)&#39;)</span>
    <span class="c1"># axes.set_ylim([0, 82])</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model: &#39;</span> <span class="o">+</span><span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Get 1 SD uncertainty on model result from uncertainty on parameters</span>
    <span class="c1"># and plot 95% CI.</span>
    <span class="k">if</span> <span class="n">plot_95ci</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">stdev</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span>
                               <span class="n">params_optimised</span><span class="p">,</span>
                               <span class="n">params_covar</span><span class="p">,</span>
                               <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span>
                               <span class="p">)</span>

        <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span>
                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span>
                                                    <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                          <span class="o">-</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">bin_centres</span><span class="p">,</span>
                                                    <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                          <span class="o">+</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
                          <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>



<div class="viewcode-block" id="plot_fitted_model">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_fitted_model">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_fitted_model</span><span class="p">(</span>
    <span class="n">axpoints</span><span class="p">,</span>
    <span class="n">fitlength</span><span class="p">,</span>
    <span class="n">params_optimised</span><span class="p">,</span>
    <span class="n">params_covar</span><span class="p">,</span>
    <span class="n">model_with_info</span><span class="p">,</span>
    <span class="n">plot_95ci</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot model fitted to experimental data, with or without</span>
<span class="sd">    confidence intervals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axpoints_fitted</span> <span class="o">=</span> <span class="n">axpoints</span><span class="p">[</span><span class="n">axpoints</span> <span class="o">&lt;=</span> <span class="n">fitlength</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">axpoints_fitted</span><span class="p">,</span>
              <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">axpoints_fitted</span><span class="p">,</span> <span class="o">*</span><span class="n">params_optimised</span><span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
              <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span>
              <span class="p">)</span>

    <span class="c1"># Get 1 SD uncertainty on model result from uncertainty on parameters</span>
    <span class="c1"># at n + 0.5 nm, and plot 95% CI.</span>
    <span class="k">if</span> <span class="n">plot_95ci</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Distances at which model is fitted</span>
        <span class="n">estimate_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span>
        <span class="c1"># Distance at which background estimate gets to zero</span>
        <span class="n">bg_offset</span> <span class="o">=</span> <span class="n">params_optimised</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bg_slope</span> <span class="o">=</span> <span class="n">params_optimised</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">x_when_bg_is_zero</span> <span class="o">=</span> <span class="o">-</span><span class="n">bg_offset</span> <span class="o">/</span> <span class="n">bg_slope</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x at zero bg is &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x_when_bg_is_zero</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
        
        <span class="c1"># Calculate CIs for bi-partite model separately, if necessary</span>
        <span class="c1"># e.g. background is linear for one section and zero for another</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1"># Confidence intervals (stdev) before background get to zero</span>
            <span class="n">estimate_points_bg_linear</span> <span class="o">=</span> <span class="n">estimate_points</span><span class="p">[</span><span class="n">estimate_points</span>
                                                        <span class="o">&lt;</span> <span class="n">x_when_bg_is_zero</span>
                                                        <span class="p">]</span>
            <span class="n">stdev_bg_linear</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">estimate_points_bg_linear</span><span class="p">,</span>
                                            <span class="n">params_optimised</span><span class="p">,</span>
                                            <span class="n">params_covar</span><span class="p">,</span>
                                            <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                                            <span class="p">)</span>
            <span class="c1"># Confidence intervals (stdev) when background is zero</span>
            <span class="n">estimate_points_bg_zero</span> <span class="o">=</span> <span class="n">estimate_points</span><span class="p">[</span><span class="n">estimate_points</span>
                                                    <span class="o">&gt;=</span> <span class="n">x_when_bg_is_zero</span>
                                                    <span class="p">]</span>
            <span class="c1"># print(&#39;Number of points with bg zero is &#39; + repr(len(estimate_points_bg_zero)))</span>
            <span class="n">stdev_bg_zero</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">estimate_points_bg_zero</span><span class="p">,</span>
                                        <span class="n">params_optimised</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
                                        <span class="n">params_covar</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span>
                                        <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="p">)</span>
            <span class="c1"># Combine confidence intervals</span>
            <span class="n">stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stdev_bg_linear</span><span class="p">,</span> <span class="n">stdev_bg_zero</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span> <span class="c1"># For one continuous model:</span>
            <span class="n">stdev</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">estimate_points</span><span class="p">,</span>
                                   <span class="n">params_optimised</span><span class="p">,</span>
                                   <span class="n">params_covar</span><span class="p">,</span>
                                   <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span>
                                   <span class="p">)</span>

        <span class="c1"># Plot confidence intervals (95%)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">estimate_points</span><span class="p">,</span>
                         <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">estimate_points</span><span class="p">,</span>
                                                   <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                         <span class="o">-</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                         <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">estimate_points</span><span class="p">,</span>
                                                   <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                         <span class="o">+</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                         <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
                         <span class="p">)</span></div>



<div class="viewcode-block" id="plot_model_components_4peaks_fixed_peak_ratio">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_model_components_4peaks_fixed_peak_ratio">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_model_components_4peaks_fixed_peak_ratio</span><span class="p">(</span>
    <span class="n">fitlength</span><span class="p">,</span>
    <span class="n">repeat_distance</span><span class="p">,</span>
    <span class="n">repeat_broadening</span><span class="p">,</span>
    <span class="n">repeat_amplitude</span><span class="p">,</span>
    <span class="n">loc_precision</span><span class="p">,</span>
    <span class="n">loc_precision_amplitude</span><span class="p">,</span>
    <span class="n">bg_slope</span><span class="p">,</span>
    <span class="n">bg_offset</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the components of this Z-disk model.</span>
<span class="sd">    Args</span>
<span class="sd">    ----</span>
<span class="sd">    fitlength (integer):</span>
<span class="sd">        Cell-axial distance upto to which the model is plotted.</span>
<span class="sd">    repeat_distance (float):</span>
<span class="sd">        Axial repeat distance through the Z-disk.</span>
<span class="sd">    repeat_broadening (float):</span>
<span class="sd">        Broadening on the cell-axial repeat term.</span>
<span class="sd">    repeat_amplitude (float):</span>
<span class="sd">        Amplitude of the first peak of the 4. Amplitudes decrease</span>
<span class="sd">        with ratios 4:3:2:1.</span>
<span class="sd">    loc_precision (float):</span>
<span class="sd">        Broadening on the peak representing repeated localisations</span>
<span class="sd">        of the same molecule.</span>
<span class="sd">    loc_precision_amplitude (float):</span>
<span class="sd">        Amplitude of the peak representing repeated localisations</span>
<span class="sd">        of the same molecule.</span>
<span class="sd">    bg_slope (float):  </span>
<span class="sd">        Slope of the background term (isotropic within the thickness</span>
<span class="sd">        of the Z-disk)</span>
<span class="sd">    bg_offset (float):</span>
<span class="sd">        Value of the background term at distance = 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">distance_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">fitlength</span><span class="p">])</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$X (nm) ($\Delta$YZ &lt; 10 nm)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">82</span><span class="p">])</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model: 5-layer Z-disk (4 peaks, fixed ratios)&#39;</span><span class="p">)</span>
 
    <span class="c1"># Plot background term</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
              <span class="n">bg_offset</span> <span class="o">+</span> <span class="n">bg_slope</span> <span class="o">*</span> <span class="n">distance_values</span>
              <span class="p">)</span>

    <span class="c1"># Plot linear repeat term</span>
    <span class="n">repeat_component</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distance_values</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">repeat_component</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">repeat_component</span>
            <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">4.</span><span class="p">)</span> <span class="o">*</span> <span class="n">repeat_amplitude</span>
                            <span class="o">*</span> <span class="n">pairwise_correlation_1d</span><span class="p">(</span>
                                <span class="n">distance_values</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">repeat_distance</span><span class="p">,</span>
                                <span class="n">repeat_broadening</span>
                                <span class="p">)</span>
            <span class="p">)</span>    
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span> <span class="n">repeat_component</span><span class="p">)</span>

    <span class="c1"># Plot term for localisations of the same molecule</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loc_precision_amplitude</span>
              <span class="o">*</span> <span class="n">pairwise_correlation_1d</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
                                        <span class="mf">0.</span><span class="p">,</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">loc_precision</span>
                                        <span class="p">)</span>
              <span class="p">)</span>

    <span class="c1"># Plot full model</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
              <span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps4fixedpeakratio</span><span class="p">(</span>
                <span class="n">distance_values</span><span class="p">,</span>
                <span class="n">repeat_distance</span><span class="p">,</span>
                <span class="n">repeat_broadening</span><span class="p">,</span>
                <span class="n">repeat_amplitude</span><span class="p">,</span>
                <span class="n">loc_precision</span><span class="p">,</span>
                <span class="n">loc_precision_amplitude</span><span class="p">,</span>
                <span class="n">bg_slope</span><span class="p">,</span>
                <span class="n">bg_offset</span>                
                <span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="plot_model_components_5peaks_variable">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.plot_model_components_5peaks_variable">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_model_components_5peaks_variable</span><span class="p">(</span>
    <span class="n">distance_values</span><span class="p">,</span>
    <span class="n">repeat_distance</span><span class="p">,</span>
    <span class="n">repeat_broadening</span><span class="p">,</span>
    <span class="n">peak1_amplitude</span><span class="p">,</span>
    <span class="n">peak2_amplitude</span><span class="p">,</span>
    <span class="n">peak3_amplitude</span><span class="p">,</span>
    <span class="n">peak4_amplitude</span><span class="p">,</span>
    <span class="n">peak5_amplitude</span><span class="p">,</span>
    <span class="n">bg_slope</span><span class="p">,</span>
    <span class="n">bg_offset</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the components of this Z-disk model.</span>
<span class="sd">    Args</span>
<span class="sd">    ----</span>
<span class="sd">    fitlength (integer):</span>
<span class="sd">        Cell-axial distance upto to which the model is plotted.</span>
<span class="sd">    repeat_distance (float):</span>
<span class="sd">        Axial repeat distance through the Z-disk.</span>
<span class="sd">    repeat_broadening (float):</span>
<span class="sd">        Broadening on the cell-axial repeat term.</span>
<span class="sd">    peak1_amplitude (float):</span>
<span class="sd">        Amplitude of the first peak due to the linear repeating pattern</span>
<span class="sd">        of localisations.</span>
<span class="sd">    peak2_amplitude to peak5_amplitude (float):</span>
<span class="sd">        As peak1_amplitude, but for peaks 2 to 5.</span>
<span class="sd">    bg_slope (float):  </span>
<span class="sd">        Slope of the background term (isotropic within the thickness</span>
<span class="sd">        of the Z-disk)</span>
<span class="sd">    bg_offset (float):</span>
<span class="sd">        Value of the background term at distance = 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$X (nm) ($\Delta$YZ &lt; 10 nm)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Model: 6-layer Z-disk (5 peaks, independent amplitudes)&#39;</span><span class="p">)</span>
 
    <span class="c1"># Plot background term</span>
    <span class="n">background</span> <span class="o">=</span> <span class="n">bg_offset</span> <span class="o">+</span> <span class="n">bg_slope</span> <span class="o">*</span> <span class="n">distance_values</span>  <span class="c1"># Background</span>
    <span class="n">background</span><span class="p">[</span><span class="n">background</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span> <span class="c1"># Cannot be negative    </span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span> <span class="n">background</span><span class="p">)</span>

    <span class="c1"># Plot linear repeat terms</span>
    <span class="n">amplitudes</span> <span class="o">=</span> <span class="p">[</span><span class="n">peak1_amplitude</span><span class="p">,</span>
                  <span class="n">peak2_amplitude</span><span class="p">,</span>
                  <span class="n">peak3_amplitude</span><span class="p">,</span>
                  <span class="n">peak4_amplitude</span><span class="p">,</span>
                  <span class="n">peak5_amplitude</span>
                  <span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
                  <span class="n">amplitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                  <span class="o">*</span> <span class="n">pairwise_correlation_1d</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
                                            <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">repeat_distance</span><span class="p">,</span>
                                            <span class="n">repeat_broadening</span>
                                            <span class="p">)</span>
                  <span class="p">)</span>

    <span class="c1"># Plot full model</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
              <span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_bg_non_negative</span><span class="p">(</span><span class="n">distance_values</span><span class="p">,</span>
                                                    <span class="n">repeat_distance</span><span class="p">,</span>
                                                    <span class="n">repeat_broadening</span><span class="p">,</span>
                                                    <span class="n">peak1_amplitude</span><span class="p">,</span>
                                                    <span class="n">peak2_amplitude</span><span class="p">,</span>
                                                    <span class="n">peak3_amplitude</span><span class="p">,</span>
                                                    <span class="n">peak4_amplitude</span><span class="p">,</span>
                                                    <span class="n">peak5_amplitude</span><span class="p">,</span>
                                                    <span class="n">bg_slope</span><span class="p">,</span>
                                                    <span class="n">bg_offset</span>                
                                                    <span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span>
              <span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">distance_values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">distance_values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>



<div class="viewcode-block" id="actn_mEos_x_plot">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.actn_mEos_x_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">actn_mEos_x_plot</span><span class="p">():</span>
    <span class="c1"># Get 2D (axial, transverse) relative positions</span>
    <span class="n">relpos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;../../perpl_test_data/ACTN2-mEos2_PERPL-relpos_200.0filter_6FOVs_aligned_len1229656.pkl&#39;</span><span class="p">)</span>

    <span class="c1"># Get subset of axial relative positions</span>
    <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">)</span>
    <span class="n">fitlength</span> <span class="o">=</span> <span class="mf">100.</span>
    <span class="c1"># loc_precision = 3.4</span>
    <span class="c1"># separation_precision = np.sqrt(2) * loc_precision</span>
    <span class="n">separation_precision</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="c1"># The smoothing is used like this so that points beyond those not</span>
    <span class="c1"># included would only have 1.1% effect on the values of the kernal</span>
    <span class="c1"># density estimate (KDE) at fitlength.</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">getaxialseparations_no_smoothing</span><span class="p">(</span>
                <span class="n">relpos</span><span class="o">=</span><span class="n">relpos</span><span class="p">,</span>
                <span class="n">max_distance</span><span class="o">=</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">separation_precision</span><span class="p">,</span>
                <span class="n">transverse_limit</span><span class="o">=</span><span class="mf">10.</span>
                <span class="p">)</span>

    <span class="c1"># Remove duplicates</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span><span class="n">axpoints</span><span class="p">)</span>

    <span class="c1"># Find kernel density estimate using localisation precision * sqrt(2)</span>
    <span class="c1"># as the Gaussian kernel.</span>
    <span class="c1"># Ues mean localisation precision estimate for mEos2:ACTN2,</span>
    <span class="c1"># after filtering to &lt; 5 nm.</span>
    <span class="c1"># kde_x_values, kde = kde_1nm(axpoints,</span>
    <span class="c1">#                             locprec=loc_precision,</span>
    <span class="c1">#                             fitlength=fitlength)</span>

    <span class="c1"># Histogram of axial separation, in 1-nm bins</span>
    <span class="n">bin_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_histogram</span><span class="p">,</span> <span class="n">bin_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                            <span class="n">bins</span><span class="o">=</span><span class="n">bin_vals</span><span class="p">)</span>

    <span class="c1"># Centre and width values for histogram bars</span>
    <span class="n">ax_bar_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">ax_fit_points</span> <span class="o">=</span> <span class="n">bin_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="c1"># Get Churchman-smoothed distribution of cell-axial distances</span>
    <span class="n">smoothed_1d_rpd</span> <span class="o">=</span> <span class="n">estimate_rpd_churchman_1d</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                                <span class="n">ax_fit_points</span><span class="p">,</span>
                                                <span class="n">separation_precision</span><span class="p">)</span>

    <span class="c1"># Plot histogram and kde for axial separations</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="mf">2.54</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mf">2.54</span><span class="p">])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ax_bar_points</span><span class="p">,</span>
             <span class="n">ax_histogram</span><span class="p">,</span>
             <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
             <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># axes.plot(kde_x_values, kde,</span>
    <span class="c1">#          lw=0.5, color=&#39;blue&#39;,</span>
    <span class="c1">#          )</span>



    <span class="c1"># Set up models and fit:</span>
    <span class="c1"># model_with_info = set_up_model_5_variable_peaks_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_5_variable_peaks_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_5_variable_peaks_bg_flat_with_fit_settings()</span>
    <span class="n">model_with_info</span> <span class="o">=</span> <span class="n">zdisk_modelling</span><span class="o">.</span><span class="n">set_up_model_5_variable_peaks_with_replocs_bg_flat_with_fit_settings</span><span class="p">()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_5_peaks_fixed_ratio_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_5_peaks_fixed_ratio_no_replocs_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_linear_fit_plusreplocs_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_onepeak_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_onepeak_plus_replocs_with_fit_settings()</span>
    <span class="c1"># model_with_info = zdisk_modelling.set_up_model_onepeak_plus_replocs_flat_bg_with_fit_settings()</span>

    <span class="p">(</span><span class="n">params_optimised</span><span class="p">,</span>
     <span class="n">params_covar</span><span class="p">,</span>
     <span class="n">params_1sd_error</span><span class="p">)</span> <span class="o">=</span> <span class="n">fitmodel_to_hist</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                                          <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">initial_params</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">param_bounds</span><span class="p">,</span>
                                          <span class="p">)</span>
    <span class="k">del</span><span class="p">(</span><span class="n">params_1sd_error</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
              <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span> <span class="o">*</span><span class="n">params_optimised</span><span class="p">),</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

    <span class="c1"># Get 1 SD uncertainty on model result from uncertainty on parameters.</span>
    <span class="n">stdev</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                           <span class="n">params_optimised</span><span class="p">,</span>
                           <span class="n">params_covar</span><span class="p">,</span>
                           <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span>
                           <span class="p">)</span>

    <span class="c1"># Plot 95% confidence interval on model</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                      <span class="o">-</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_fit_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
                      <span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;mEos_Xfit.pdf&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="lasp_mEos_plot">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.lasp_mEos_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lasp_mEos_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit axial KDE of relative positions of myopalladin:mEos localisations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get 2D (axial, transverse) relative positions</span>
    <span class="n">relpos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;../../perpl_test_data/mEos3-LASP2_PERPL-relpos_200.0filter_5FOVs_aligned_len533140.pkl&#39;</span><span class="p">)</span>
        
    <span class="c1"># &#39;S:/Peckham/Bioimaging/Alistair/PALM-STORM&#39;</span>
    <span class="c1"># &#39;/AlexasNearestNeighbours/LASP2&#39;</span>
    <span class="c1"># &#39;/nns-aligned-5fovs.pkl&#39;)</span>

    <span class="c1"># Get subset of axial relative positions</span>
    <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">)</span>
    <span class="n">fitlength</span> <span class="o">=</span> <span class="mf">100.</span>
    <span class="n">loc_precision</span> <span class="o">=</span> <span class="mf">3.4</span>
    <span class="n">separation_precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">loc_precision</span>
    <span class="c1"># The smoothing is used like this so that points beyond those not</span>
    <span class="c1"># included would only have 0.03% effect on the values of the kernal</span>
    <span class="c1"># density estimate (KDE) at fitlength.</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">getaxialseparations_no_smoothing</span><span class="p">(</span>
                <span class="n">relpos</span><span class="o">=</span><span class="n">relpos</span><span class="p">,</span>
                <span class="n">max_distance</span><span class="o">=</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">separation_precision</span><span class="p">,</span>
                <span class="n">transverse_limit</span><span class="o">=</span><span class="mf">10.</span>
                <span class="p">)</span>

    <span class="c1"># Remove duplicates</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span><span class="n">axpoints</span><span class="p">)</span>

    <span class="c1"># Find kernel density estimate using localisation precision * sqrt(2)</span>
    <span class="c1"># as the Gaussian kernel.</span>
    <span class="c1"># Ues mean localisation precision estimate for mEos2:ACTN2,</span>
    <span class="c1"># after filtering to &lt; 5 nm.</span>
    <span class="c1"># kde_x_values, kde = kde_1nm(axpoints,</span>
    <span class="c1">#                            locprec=loc_precision,</span>
    <span class="c1">#                            fitlength=fitlength)</span>

    <span class="c1"># Histogram of axial separation, in 1-nm bins</span>
    <span class="n">bin_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_histogram</span><span class="p">,</span> <span class="n">bin_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                            <span class="n">bins</span><span class="o">=</span><span class="n">bin_vals</span><span class="p">)</span>

    <span class="c1"># Centre and width values for histogram bars</span>
    <span class="n">ax_plot_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">1.</span>
    
    <span class="c1"># Get Churchman-smoothed distribution of cell-axial distances</span>
    <span class="n">smoothed_1d_rpd</span> <span class="o">=</span> <span class="n">estimate_rpd_churchman_1d</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                                <span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="n">separation_precision</span><span class="p">)</span>

    <span class="c1"># Set up models and fit:</span>
    <span class="c1"># for model_with_info in [# set_up_model_5_variable_peaks_with_fit_settings(),</span>
    <span class="c1">#                        set_up_model_4_variable_peaks_with_fit_settings()</span>
    <span class="c1">#                        ]:</span>
    <span class="c1"># model_with_info = set_up_model_5_variable_peaks_with_fit_settings()</span>
    <span class="c1"># model_with_info = set_up_model_5_variable_peaks_after_offset_with_fit_settings()</span>
    <span class="c1"># model_with_info = set_up_model_linear_fit_with_fit_settings()</span>
    <span class="n">model_with_info</span> <span class="o">=</span> <span class="n">zdisk_modelling</span><span class="o">.</span><span class="n">set_up_model_5_variable_peaks_after_offset_flat_bg_with_fit_settings</span><span class="p">()</span>

    <span class="c1"># Plot histogram and kde for axial separations</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="mf">2.54</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mf">2.54</span><span class="p">])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
             <span class="n">ax_histogram</span><span class="p">,</span>
             <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span> <span class="n">smoothed_1d_rpd</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span> <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________________________&#39;</span><span class="p">)</span>

    <span class="p">(</span><span class="n">params_optimised</span><span class="p">,</span>
    <span class="n">params_covar</span><span class="p">,</span>
    <span class="n">params_1sd_error</span><span class="p">)</span> <span class="o">=</span> <span class="n">fitmodel_to_hist</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                         <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                                         <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">,</span>
                                         <span class="n">model_with_info</span><span class="o">.</span><span class="n">initial_params</span><span class="p">,</span>
                                         <span class="n">model_with_info</span><span class="o">.</span><span class="n">param_bounds</span><span class="p">,</span>
                                         <span class="p">)</span>
    <span class="k">del</span><span class="p">(</span><span class="n">params_1sd_error</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
              <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span> <span class="o">*</span><span class="n">params_optimised</span><span class="p">),</span>
              <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Get 1 SD uncertainty on model result from uncertainty on parameters.</span>
    <span class="n">stdev</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                           <span class="n">params_optimised</span><span class="p">,</span>
                           <span class="n">params_covar</span><span class="p">,</span>
                           <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span>
                           <span class="p">)</span>

    <span class="c1"># Plot 95% confidence interval on model</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                                                <span class="o">-</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                                                <span class="o">+</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
                      <span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Axial separation (nm)&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;LASP2_Xfit.pdf&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="mypn_mEos_plot">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_plots.mypn_mEos_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mypn_mEos_plot</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit axial KDE of relative positions of myopalladin:mEos localisations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get 2D (axial, transverse) relative positions</span>
    <span class="n">relpos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;../../perpl_test_data/mEos3-MYPN_NNS_aligned_5_FOVs_len1445698.pkl&#39;</span><span class="p">)</span>

    <span class="c1"># Get subset of axial relative positions</span>
    <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">)</span>
    <span class="n">fitlength</span> <span class="o">=</span> <span class="mf">100.</span>
    <span class="n">loc_precision</span> <span class="o">=</span> <span class="mf">3.4</span>
    <span class="n">separation_precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">loc_precision</span>

    <span class="c1"># The smoothing is used like this so that points beyond those not</span>
    <span class="c1"># included would only have 0.03% effect on the values of the kernal</span>
    <span class="c1"># density estimate (KDE) at fitlength.</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">getaxialseparations_no_smoothing</span><span class="p">(</span>
                <span class="n">relpos</span><span class="o">=</span><span class="n">relpos</span><span class="p">,</span>
                <span class="n">max_distance</span><span class="o">=</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">separation_precision</span><span class="p">,</span>
                <span class="n">transverse_limit</span><span class="o">=</span><span class="mf">10.</span>
                <span class="p">)</span>

    <span class="c1"># Remove duplicates</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span><span class="n">axpoints</span><span class="p">)</span>

    <span class="c1"># Histogram of axial separation, in 1-nm bins</span>
    <span class="n">bin_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax_histogram</span><span class="p">,</span> <span class="n">bin_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                            <span class="n">bins</span><span class="o">=</span><span class="n">bin_vals</span><span class="p">)</span>

    <span class="c1"># Centre and width values for histogram bars</span>
    <span class="n">ax_plot_points</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">bar_width</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="c1"># Get Churchman-smoothed distribution of cell-axial distances</span>
    <span class="n">smoothed_1d_rpd</span> <span class="o">=</span> <span class="n">estimate_rpd_churchman_1d</span><span class="p">(</span><span class="n">axpoints</span><span class="p">,</span>
                                                <span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="n">separation_precision</span><span class="p">)</span>

    <span class="c1"># Plot histogram and kde for axial separations</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="mf">2.54</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mf">2.54</span><span class="p">])</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
             <span class="n">ax_histogram</span><span class="p">,</span>
             <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span> <span class="n">smoothed_1d_rpd</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                      <span class="mi">0</span><span class="p">,</span> <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                      <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

    <span class="c1"># Set up models and fit:</span>
    <span class="n">model_with_info</span> <span class="o">=</span> <span class="n">set_up_model_5_variable_peaks_with_fit_settings</span><span class="p">()</span>
    <span class="c1"># model_with_info = set_up_model_linear_fit_with_fit_settings()</span>

    <span class="p">(</span><span class="n">params_optimised</span><span class="p">,</span>
     <span class="n">params_covar</span><span class="p">,</span>
     <span class="n">params_1sd_error</span><span class="p">)</span> <span class="o">=</span> <span class="n">fitmodel_to_hist</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                          <span class="n">smoothed_1d_rpd</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">initial_params</span><span class="p">,</span>
                                          <span class="n">model_with_info</span><span class="o">.</span><span class="n">param_bounds</span><span class="p">,</span>
                                          <span class="p">)</span>
    <span class="k">del</span> <span class="n">params_1sd_error</span>

    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
              <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span> <span class="o">*</span><span class="n">params_optimised</span><span class="p">),</span>
              <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Get 1 SD uncertainty on model result from uncertainty on parameters.</span>
    <span class="n">stdev</span> <span class="o">=</span> <span class="n">stdev_of_model</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                           <span class="n">params_optimised</span><span class="p">,</span>
                           <span class="n">params_covar</span><span class="p">,</span>
                           <span class="n">model_with_info</span><span class="o">.</span><span class="n">vector_input_model</span>
                           <span class="p">)</span>

    <span class="c1"># Plot 95% confidence interval on model</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                      <span class="o">-</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">model_with_info</span><span class="o">.</span><span class="n">model_rpd</span><span class="p">(</span><span class="n">ax_plot_points</span><span class="p">,</span>
                                                <span class="o">*</span><span class="n">params_optimised</span><span class="p">)</span>
                      <span class="o">+</span> <span class="n">stdev</span> <span class="o">*</span> <span class="mf">1.96</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span>
                      <span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;MYPN_Xfit.pdf&#39;</span><span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">PERPL</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">perpl</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Alistair Curd.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>