<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>perpl.modelling.zdisk_modelling &#8212; PERPL  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for perpl.modelling.zdisk_modelling</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">zdisk_modelling.py</span>

<span class="sd">Functions to fit models of relative positions in Z-disk data to</span>
<span class="sd">relative positions among localisation microscopy data.</span>

<span class="sd">Created on Wed Dec 12 14:28:49 2018</span>

<span class="sd">Alistair Curd</span>
<span class="sd">University of Leeds</span>
<span class="sd">30 July 2018</span>

<span class="sd">Software Engineering practices applied</span>

<span class="sd">Joanna Leng (an EPSRC funded Research Software Engineering Fellow (EP/R025819/1)</span>
<span class="sd">University of Leeds</span>
<span class="sd">January 2019</span>

<span class="sd">---</span>
<span class="sd">Copyright 2018 Peckham Lab</span>

<span class="sd">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use</span>
<span class="sd">this file except in compliance with the License. You may obtain a copy of the</span>
<span class="sd">License at</span>
<span class="sd">http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="sd">Unless required by applicable law or agreed to in writing, software distributed</span>
<span class="sd">under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR</span>
<span class="sd">CONDITIONS OF ANY KIND, either express or implied. See the License for the</span>
<span class="sd">specific language governing permissions and limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">perpl.modelling.linearrepeatmodels</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">linmods</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">perpl.modelling.models_2d_distances_normalised</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mods2d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">perpl.modelling.modelling_general</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelWithFitSettings</span>


<div class="viewcode-block" id="read_relpos_from_pickles">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.read_relpos_from_pickles">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_relpos_from_pickles</span><span class="p">(</span><span class="n">input_files</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare array of relative positions, for use in analysis and figures,</span>
<span class="sd">    using data in pickle files.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_files (list):</span>
<span class="sd">            The list of paths from which the relative position data should be</span>
<span class="sd">            read.</span>
<span class="sd">            If only one input file, use as a list of length 1, i.e. in [].</span>

<span class="sd">    Returns:</span>
<span class="sd">        relpos (numpy-like array):</span>
<span class="sd">            The list of 2D or 3D relative positions, aggregated over all</span>
<span class="sd">            input files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use Affimer data pickles by default</span>
    <span class="n">relpos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">input_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_files</span><span class="p">)):</span>
            <span class="n">relpos</span> <span class="o">=</span> <span class="n">relpos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">input_files</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">relpos</span></div>



<div class="viewcode-block" id="getaxialseparations_no_smoothing">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.getaxialseparations_no_smoothing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getaxialseparations_no_smoothing</span><span class="p">(</span><span class="n">relpos</span><span class="p">,</span>
                                     <span class="n">max_distance</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span>
                                     <span class="n">transverse_limit</span><span class="o">=</span><span class="mf">10.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get axial separations between localisations, also within a limited</span>
<span class="sd">    transverse distance of one another.</span>

<span class="sd">    Args:</span>
<span class="sd">        relpos:</span>
<span class="sd">            Relative positions containing .axial and .transverse</span>
<span class="sd">            distance (e.g. pandas dataframe).</span>
<span class="sd">        max_distance:</span>
<span class="sd">            The maximum axial separation upto which data will be</span>
<span class="sd">            modelled.</span>
<span class="sd">        transverselimit:</span>
<span class="sd">            The maximum distance across the transverse plane</span>
<span class="sd">            between localisations involved.</span>
<span class="sd">    Returns:</span>
<span class="sd">        sorted_axpoints:</span>
<span class="sd">            The axial separations as desired, sorted from lowest to</span>
<span class="sd">            highest.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make all axial separations positive.</span>
    <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">)</span>

    <span class="c1"># Select desired data.</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">[(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">)</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">transverse</span> <span class="o">&lt;</span> <span class="n">transverse_limit</span><span class="p">)]</span>
    <span class="n">sorted_axpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axpoints</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_axpoints</span></div>



<div class="viewcode-block" id="getaxialseparations_with_smoothing">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.getaxialseparations_with_smoothing">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">getaxialseparations_with_smoothing</span><span class="p">(</span><span class="n">relpos</span><span class="p">,</span>
                                       <span class="n">fitlength</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span>
                                       <span class="n">locprec</span><span class="o">=</span><span class="mf">3.1</span><span class="p">,</span> <span class="c1"># AF647 default</span>
                                       <span class="n">transverse_limit</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                                       <span class="n">smoothing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get axial separations between localisations, also within a limited</span>
<span class="sd">    transverse distance of one another.</span>

<span class="sd">    Args:</span>
<span class="sd">        relpos:</span>
<span class="sd">            Relative positions containing .axial and .transverse</span>
<span class="sd">            distance (e.g. pandas dataframe).</span>
<span class="sd">        fitlength:</span>
<span class="sd">            The maximum axial separation upto which data will be</span>
<span class="sd">            modelled.</span>
<span class="sd">        locprec:</span>
<span class="sd">            Average localisation precision of the localisations involved.</span>
<span class="sd">        transverselimit:</span>
<span class="sd">            The maximum distance across the transverse plane</span>
<span class="sd">            between localisations involved.</span>
<span class="sd">    Returns:</span>
<span class="sd">        axpoints:</span>
<span class="sd">            The axial separations as desired, sorted from lowest to</span>
<span class="sd">            highest.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make all axial separations positive.</span>
    <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">)</span>

    <span class="n">smoothing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">locprec</span>

    <span class="c1"># Select desired data.</span>
    <span class="c1"># The smoothing is used like this so that points beyond those not</span>
    <span class="c1"># included would only have 1% effect on the values at fitlength</span>
    <span class="n">axpoints</span> <span class="o">=</span> <span class="n">relpos</span><span class="o">.</span><span class="n">axial</span><span class="p">[(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">fitlength</span> <span class="o">+</span> <span class="n">smoothing</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">transverse</span> <span class="o">&lt;</span> <span class="n">transverse_limit</span><span class="p">)]</span>
    <span class="n">sorted_axpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axpoints</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_axpoints</span></div>



<div class="viewcode-block" id="get_transverse_separations">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.get_transverse_separations">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_transverse_separations</span><span class="p">(</span><span class="n">relpos</span><span class="p">,</span>
                               <span class="n">max_distance</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span>
                               <span class="n">axial_limit</span><span class="o">=</span><span class="mf">10.</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get axial separations between localisations, also within a limited</span>
<span class="sd">    transverse distance of one another.</span>

<span class="sd">    Args:</span>
<span class="sd">        relpos:</span>
<span class="sd">            Relative positions containing .axial and .transverse</span>
<span class="sd">            distance (e.g. pandas dataframe).</span>
<span class="sd">        max_distance:</span>
<span class="sd">            The maximum transverse separation upto which data will be</span>
<span class="sd">            analysed.</span>
<span class="sd">        axial_limit:</span>
<span class="sd">            The maximum distance along the cell-axis</span>
<span class="sd">            between localisations involved.</span>
<span class="sd">    Returns:</span>
<span class="sd">        sorted_trans_points:</span>
<span class="sd">            The axial separations as desired, sorted from lowest to</span>
<span class="sd">            highest.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Select desired data.</span>
    <span class="n">trans_points</span> <span class="o">=</span> <span class="n">relpos</span><span class="o">.</span><span class="n">transverse</span><span class="p">[(</span><span class="n">relpos</span><span class="o">.</span><span class="n">transverse</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">)</span>
                                      <span class="o">&amp;</span> <span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">&lt;</span> <span class="n">axial_limit</span><span class="p">)</span>
                                      <span class="o">&amp;</span> <span class="p">(</span><span class="n">relpos</span><span class="o">.</span><span class="n">axial</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">axial_limit</span><span class="p">)]</span>
    <span class="n">sorted_trans_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">trans_points</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_trans_points</span></div>



<div class="viewcode-block" id="remove_duplicates">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.remove_duplicates">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">sortedrelpos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Slice relative positions so that duplicates are removed. This can be</span>
<span class="sd">    necessary when absolute amplitude of the</span>
<span class="sd">    histograms/density is important.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slicedrelpos</span> <span class="o">=</span> <span class="n">sortedrelpos</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">slicedrelpos</span></div>



<div class="viewcode-block" id="fitmodel_to_hist">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.fitmodel_to_hist">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fitmodel_to_hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                     <span class="n">experimentaldist</span><span class="p">,</span>
                     <span class="n">model</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps5fixedpeakratio</span><span class="p">,</span>
                     <span class="n">initial_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">param_bounds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit model to distance histogram. Designed to allow user editting of</span>
<span class="sd">    parameter guesses and bounds for models of RPDs for linear repeating</span>
<span class="sd">    models, as in linearrepeatmodels.py.</span>

<span class="sd">    Args:</span>
<span class="sd">        x:</span>
<span class="sd">            Distance values at which the experimental distribution of</span>
<span class="sd">            distances and the model are evaluated.</span>
<span class="sd">        experimentaldist:</span>
<span class="sd">            The values of the experimental distribution of distances. Can be</span>
<span class="sd">            e.g. histogram or KDE.</span>
<span class="sd">        model:</span>
<span class="sd">            The model for the RPD.</span>
<span class="sd">        fitlength:</span>
<span class="sd">            The maximum distance that may be included in the fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">experimentaldist</span><span class="p">,</span>
            <span class="n">p0</span><span class="o">=</span><span class="n">initial_params</span><span class="p">,</span>
            <span class="n">bounds</span><span class="o">=</span><span class="n">param_bounds</span>
            <span class="p">)</span>
    <span class="c1"># plt.plot(x, model(x, *popt))</span>
    <span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">popt</span><span class="p">,</span> <span class="n">perr</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># No. free parameters,</span>
                              <span class="c1"># including var. of residuals</span>
                              <span class="c1"># for least squares fit.</span>

    <span class="n">ssr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">)</span>
                  <span class="o">-</span> <span class="n">experimentaldist</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">ssr</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span>
    <span class="n">aiccorr</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SSR =&#39;</span><span class="p">,</span> <span class="n">ssr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AIC =&#39;</span><span class="p">,</span> <span class="n">aic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AICcorr =&#39;</span><span class="p">,</span> <span class="n">aiccorr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">perr</span></div>



<div class="viewcode-block" id="create_default_fitting_params_dicts">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.create_default_fitting_params_dicts">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">create_default_fitting_params_dicts</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create lists for initial guesses and bounds for parameters during</span>
<span class="sd">    fitting. Sets the defaults for scipy.optimise.curve_fit</span>

<span class="sd">    Returns:</span>
<span class="sd">        lower_bound_dict (dict):</span>
<span class="sd">            Dictionary of default lower bound options for parameter values.</span>
<span class="sd">        upper_bound_dict (dict):</span>
<span class="sd">            Dictionary of default upper bound options for parameter values.</span>
<span class="sd">        initial_params_dict (dict):</span>
<span class="sd">            Dictionary of default initial parameter value options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lower_bound_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;repeat_distance&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;repeat_broadening&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;first_peak_offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_2&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_3&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_4&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_5&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_6&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;bg_slope&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;bg_offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="n">upper_bound_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;repeat_distance&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;repeat_broadening&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;first_peak_offset&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_1&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_2&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_3&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_4&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_5&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_6&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="s1">&#39;bg_slope&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;bg_offset&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="n">initial_params_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;repeat_distance&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s1">&#39;repeat_broadening&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;first_peak_offset&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_3&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_4&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_5&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;amp_peak_6&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;bg_slope&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="s1">&#39;bg_offset&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">return</span> <span class="n">lower_bound_dict</span><span class="p">,</span> <span class="n">upper_bound_dict</span><span class="p">,</span> <span class="n">initial_params_dict</span></div>



<div class="viewcode-block" id="set_up_model_3_peaks_fixed_ratio_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_3_peaks_fixed_ratio_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_3_peaks_fixed_ratio_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps3fixedpeakratio</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps3fixedpeakratiovectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_4_peaks_fixed_ratio_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_4_peaks_fixed_ratio_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_4_peaks_fixed_ratio_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps4fixedpeakratio</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps4fixedpeakratiovectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_peaks_fixed_ratio_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_peaks_fixed_ratio_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_peaks_fixed_ratio_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps5fixedpeakratio</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps5fixedpeakratiovectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_peaks_fixed_ratio_no_replocs_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_peaks_fixed_ratio_no_replocs_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_peaks_fixed_ratio_no_replocs_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    </span>
<span class="sd">    This model has five peaks on a linear repeats, with linear decreasing</span>
<span class="sd">    amplitude, above a linear sloping backgroung, with no component for</span>
<span class="sd">    repeated localisations.</span>
<span class="sd">    </span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_fixedpeakratio</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_fixedpeakratio_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_variable_peaks_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_variable_peaks_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_variable_peaks_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_bg_non_negative</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_bg_linear_vectorinput</span>
        <span class="p">)</span>
        <span class="c1"># linmods.linrepnoreps5_bg_zero_vectorinput</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_variable_peaks_bg_flat_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_variable_peaks_bg_flat_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_variable_peaks_bg_flat_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has five peaks on a linear repeat with independent</span>
<span class="sd">    amplitudes. With a flat background level.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_bg_flat</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps5_bg_flat_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_variable_peaks_with_replocs_bg_flat_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_variable_peaks_with_replocs_bg_flat_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_variable_peaks_with_replocs_bg_flat_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has five peaks on a linear repeat with independent</span>
<span class="sd">    amplitudes. With a flat background level. With repeated</span>
<span class="sd">    localisations.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps5_bg_flat</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span><span class="c1"># upper_bound_dict[&#39;loc_prec_sd&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linrepplusreps5_bg_flat_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_variable_peaks_after_offset_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_variable_peaks_after_offset_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_variable_peaks_after_offset_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_5</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="mf">10.</span><span class="p">,</span><span class="c1">#initial_params_dict[&#39;first_peak_offset&#39;],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_6&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_6&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_6&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_5_vectorargs</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_5_variable_peaks_after_offset_flat_bg_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_5_variable_peaks_after_offset_flat_bg_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_5_variable_peaks_after_offset_flat_bg_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    </span>
<span class="sd">    This model has a term for repeated localisations, followed by peaks at</span>
<span class="sd">    offset + n * repeat distance, where is 1-5. With a flat background term.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_5_flat_bg_replocs</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_6&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_5&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_6&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="mf">10.</span><span class="p">,</span><span class="c1">#upper_bound_dict[&#39;first_peak_offset&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="mf">1000.</span><span class="p">,</span><span class="c1">#upper_bound_dict[&#39;amp_peak_5&#39;],</span>
                    <span class="mf">10000.</span><span class="p">,</span><span class="c1">#upper_bound_dict[&#39;amp_peak_6&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_5_flat_bg_replocs_vectorargs</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_4_variable_peaks_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_4_variable_peaks_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_4_variable_peaks_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps4_bg_non_negative</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps4_bg_linear_vectorinput</span><span class="p">,</span>
         <span class="n">linmods</span><span class="o">.</span><span class="n">linrepnoreps4_bg_zero_vectorinput</span>
         <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_4_variable_peaks_after_offset_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_4_variable_peaks_after_offset_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_4_variable_peaks_after_offset_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_4</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;first_peak_offset&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_3&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_4&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">lin_repeat_after_offset_4_vectorargs</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_linear_fit_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_linear_fit_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_linear_fit_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">linear_fit</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">linear_fit_vector_args</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_linear_fit_plusreplocs_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_linear_fit_plusreplocs_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_linear_fit_plusreplocs_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>
<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">justreplocs</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span> 
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="c1"># upper_bound_dict[&#39;loc_prec_sd&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">justreplocs_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_onepeak_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_onepeak_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_onepeak_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has one peak representing a characteristic</span>
<span class="sd">    distance, and no repeated localisations.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">onepeaknoreps</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">onepeaknoreps_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_onepeak_plus_replocs_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_onepeak_plus_replocs_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_onepeak_plus_replocs_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has one peak representing a characteristic</span>
<span class="sd">    distance, as well as repeated localisations.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span><span class="c1"># upper_bound_dict[&#39;loc_prec_sd&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_slope&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_onepeak_plus_replocs_flat_bg_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_onepeak_plus_replocs_flat_bg_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_onepeak_plus_replocs_flat_bg_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has one peak representing a characteristic</span>
<span class="sd">    distance, as well as repeated localisations. Only uniform background level.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps_flat_bg</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">15.</span><span class="p">,</span><span class="c1">#initial_params_dict[&#39;repeat_distance&#39;],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="mi">100</span><span class="p">,</span><span class="c1"># upper_bound_dict[&#39;loc_prec_sd&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps_flat_bg_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_2d_onepeak_plus_replocs_flat_bg_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_2d_onepeak_plus_replocs_flat_bg_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_2d_onepeak_plus_replocs_flat_bg_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has one peak representing a characteristic</span>
<span class="sd">    distance, as well as repeated localisations. Only uniform background level.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">mods2d</span><span class="o">.</span><span class="n">onepeakplusreps_normalised_flat_bg</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mods2d</span><span class="o">.</span><span class="n">onepeakplusreps_normalised_flat_bg_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_onepeak_plus_replocs_no_bg_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_onepeak_plus_replocs_no_bg_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_onepeak_plus_replocs_no_bg_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has one peak representing a characteristic</span>
<span class="sd">    distance, as well as repeated localisations.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps_no_bg</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_sd&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="mi">50</span><span class="p">,</span><span class="c1"># upper_bound_dict[&#39;loc_prec_sd&#39;],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;loc_prec_amp&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">linmods</span><span class="o">.</span><span class="n">onepeakplusreps_no_bg_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>



<div class="viewcode-block" id="set_up_model_2d_twopeaks_flat_bg_with_fit_settings">
<a class="viewcode-back" href="../../../perpl.modelling.html#perpl.modelling.zdisk_modelling.set_up_model_2d_twopeaks_flat_bg_with_fit_settings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_up_model_2d_twopeaks_flat_bg_with_fit_settings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up the RPD model with fitting settings.</span>

<span class="sd">    This model has two peaks representing characteristic</span>
<span class="sd">    distances. Only uniform background level.</span>

<span class="sd">    The fitting settings are to pass to scipy&#39;s</span>
<span class="sd">    curve_fit, and the vector-input version of the model is for</span>
<span class="sd">    differentiation and error propagation with numdifftools.</span>

<span class="sd">    Args:</span>
<span class="sd">        None</span>

<span class="sd">    Returns:</span>
<span class="sd">        A ModelWithFitSettings object containing:</span>
<span class="sd">            model_rpd (function name):</span>
<span class="sd">                Relative position density as a function of separation</span>
<span class="sd">                between localisations.</span>
<span class="sd">            initial_params (list):</span>
<span class="sd">                Starting guesses for the parameter values by</span>
<span class="sd">                scipy.optimize.curve_fit</span>
<span class="sd">            lower_bounds (list), upper_bounds (list):</span>
<span class="sd">                The bounds on allowable parameter values as</span>
<span class="sd">                scipy.optimize.curve_fit runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate ModelWithFitSettings object, conatining a model_rpd</span>
    <span class="n">model_with_fit_settings</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelWithFitSettings</span><span class="p">(</span><span class="n">model_rpd</span><span class="o">=</span><span class="n">mods2d</span><span class="o">.</span><span class="n">twopeaks_normalised_flat_bg</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># Add fitting parameters to ModelWithFitSettings object</span>
    <span class="p">(</span><span class="n">lower_bound_dict</span><span class="p">,</span>
     <span class="n">upper_bound_dict</span><span class="p">,</span>
     <span class="n">initial_params_dict</span><span class="p">)</span> <span class="o">=</span> <span class="n">create_default_fitting_params_dicts</span><span class="p">()</span>

    <span class="c1"># Can optionally modify these dictionaries here:</span>

    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">,</span>   
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>                      
                      <span class="n">initial_params_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                      <span class="p">]</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">lower_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_distance&#39;</span><span class="p">],</span>
                    <span class="mf">50.</span><span class="p">,</span><span class="c1">#upper_bound_dict[&#39;repeat_distance&#39;],    </span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;repeat_broadening&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_1&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;amp_peak_2&#39;</span><span class="p">],</span>
                    <span class="n">upper_bound_dict</span><span class="p">[</span><span class="s1">&#39;bg_offset&#39;</span><span class="p">]</span>
                    <span class="p">]</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">)</span>

    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">initial_params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">initial_params</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">param_bounds</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">bounds</span>
        <span class="p">)</span>
    <span class="n">model_with_fit_settings</span><span class="o">.</span><span class="n">vector_input_model</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">mods2d</span><span class="o">.</span><span class="n">twopeaks_normalised_flat_bg_vectorinput</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model_with_fit_settings</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">PERPL</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">perpl</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Alistair Curd.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>